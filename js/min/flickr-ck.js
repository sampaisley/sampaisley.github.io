function wordInString(e,t){return new RegExp("\\b"+t+"\\b","gi").test(e)}function setImage(){theImage.src=_Y+_X-1<images.length?images[_Y+_X-1][0]:"../img/noImage.jpg"}function setTitle(){title.innerHTML=_Y+_X-1<images.length?"Title:<br>"+images[_Y+_X-1][2]:"No More From "+tag}function reSetDragger(e){if(oldHeight>e&&parseInt(dragger.style.top)+1.5*grid_size>high){var t=Math.ceil(e/squaresAccross-1);dragger.style.top=t*grid_size+"px";var r=parseInt(dragger.style.top)/grid_size,i=parseInt(dragger.style.left)/grid_size-1;_X=i+2,_Y=r*squaresAccross,dragger.innerHTML=r*squaresAccross+i+2,setImage(),setTitle()}oldHeight=e}function setDivHeight(e){var t=3,r=Math.ceil(e/3);strips.style.height=r*grid_size+2*borderWidth+"px",strips.style.width=t*grid_size+2*borderWidth+"px",wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,reSetDragger(e)}function makeArray(e){images=[];for(var t=0;t<jso.photos.photo.length;++t)if(wordInString(jso.photos.photo[t].tags,e)){var r="http://farm"+jso.photos.photo[t].farm+".staticflickr.com/"+jso.photos.photo[t].server+"/"+jso.photos.photo[t].id+"_"+jso.photos.photo[t].secret+"_m.jpg";tag=jso.photos.photo[t].tags.split(" ")[0],tit=jso.photos.photo[t].title,images.push([r,tag,tit])}}function jsonFlickrApi(e){jso=e,makeArray(tag),setImage(),setTitle(),setDivHeight(images.length)}function onDragMove(e){_X=e.position.x/grid_size+1,_Y=Math.floor(e.position.y/grid_size*squaresAccross),dragger.innerHTML=_Y+_X}function onDragEnd(){setImage(),setTitle()}function setActiveClass(e,t){for(var r=document.querySelectorAll(".butto"),i=0;i<r.length;i++)r[i].classList.remove(t);e.classList.add(t)}function changeSet(e){makeArray(tag=e),setImage(),setTitle(),setDivHeight(images.length)}var dragger=document.querySelector("#draggable"),strips=document.querySelector("#strips"),borderWidth=10;strips.style.borderWidth=borderWidth+"px";var theImage=document.querySelector("#theImage"),title=document.querySelector("#title"),tit,grid_size=dragger.clientWidth,wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,images=[],Draggabilly,jso={},tag="france",_X=0,_Y=1,oldHeight,draggie=new Draggabilly(dragger,{grid:[grid_size,grid_size],containment:!0});draggie.on("dragMove",onDragMove),draggie.on("dragEnd",onDragEnd);var france=document.querySelector("#france"),field=document.querySelector("#field"),sea=document.querySelector("#sea"),numbers=document.querySelector("#numbers");france.onclick=numbers.onclick=field.onclick=sea.onclick=function(){changeSet(this.getAttribute("id")),setActiveClass(this,"active")},dragger.ondblclick=function(){alert("Don't click it dumbo, drag it")};