function wordInString(e,t){return new RegExp("\\b"+t+"\\b","gi").test(e)}function reJig(e){var t=parseInt(e)-grid_size;dragger.style.left=t+"px",dragger.innerHTML=currentThumb,window.clearTimeout(timeoutID),currentThumb--,setImage(),setTitle(),title.classList.remove("noImage")}function setImage(e){e=e||currentThumb,e<images.length?theImage.src=images[e][0]:(theImage.src="../img/noImage.jpg",timeoutID=window.setTimeout(function(){reJig(dragger.style.left)},300))}function setTitle(e){e=e||currentThumb,title.innerHTML=e<images.length?images[e][2]:"No Image"}function reSetDragger(e){if(oldNumOfPhotos>e&&parseInt(dragger.style.top)+1.5*grid_size>high){var t=Math.ceil(e/squaresAccross-1)*grid_size+"px";dragger.style.top=t;var r=parseInt(dragger.style.top)/grid_size,i=parseInt(dragger.style.left)/grid_size;_X=i,_Y=r*squaresAccross,dragger.innerHTML=r*squaresAccross+i+1,currentThumb=r*squaresAccross+i,setImage(),setTitle()}oldNumOfPhotos=e}function draggerShadowThumbs(e,t){dragger.style.left=e+"px",dragger.style.top=t+"px"}function setActiveClass(e,t,r){for(var i=document.querySelectorAll(e),s=i.length;s--;)i[s].classList.remove(t);r.classList.add(t)}function setDivHeight(e){var t=3,r=Math.ceil(e/3);strips.style.height=r*grid_size+2*borderWidth+"px",strips.style.width=t*grid_size+2*borderWidth+"px",wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,reSetDragger(e)}function sortbydate(e,t){return e.datetaken>t.datetaken?1:e.datetaken<t.datetaken?-1:0}function makeArray(e){jso.sort(sortbydate),images=[];for(var t=jso.length;t--;)if(wordInString(jso[t].tags,e)){numOfThumbs++;var r=jso[t].url_n,i=jso[t].url_sq;tag=jso[t].tags,tit=jso[t].title;var s=jso[t].datetaken;images.unshift([r,tag,tit,i,s])}}function thumbs(){thumbDiv.innerHTML="";for(var e,t=0;numOfThumbs>t;++t)e=document.createElement("img"),e.src=images[t][3],e.setAttribute("class"," thumb"),e.setAttribute("id",t),thumbDiv.appendChild(e)}function jsonFlickrApi(e){jso=e.photos.photo,makeArray(tag),setImage(),setTitle(),setDivHeight(images.length)}function onDragMove(e){_X=e.position.x/grid_size,_Y=Math.floor(e.position.y/grid_size*squaresAccross),currentThumb=_Y+_X,dragger.innerHTML=currentThumb+1,setTitle(),currentThumb!==dragStartPoint&&title.classList.add("moving"),currentThumb>images.length-1?title.classList.add("noImage"):title.classList.remove("noImage")}function onDragEnd(){setImage(),setTitle(),title.classList.remove("moving")}function changeSet(e){numOfThumbs=0,makeArray(tag=e),setTitle(),setDivHeight(images.length),setImage(),thumbsMode&&(thumbs(),setActiveClass(".thumb","active",document.getElementById(currentThumb)))}var dragger=document.querySelector("#draggable"),strips=document.querySelector("#strips"),thumbDiv=document.querySelector("#thumbs"),numOfThumbs=0,borderWidth=10;strips.style.borderWidth=borderWidth+"px";var theImage=document.querySelector("#theImage"),title=document.querySelector("#title"),tit,grid_size=dragger.offsetWidth,wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,thumbsMode=!1,images=[],Draggabilly,jso={},tag="france",currentThumb=0,dragStartPoint=0,_X=0,_Y=0,oldNumOfPhotos,timeoutID;thumbDiv.addEventListener("click",function(e){"IMG"===e.target.nodeName&&(currentThumb=e.target.getAttribute("id"),setImage(),setTitle(),dragger.innerHTML=parseInt(currentThumb)+1,draggerShadowThumbs(e.target.offsetLeft-borderWidth,e.target.offsetTop-borderWidth),setActiveClass(".thumb","active",e.target),title.classList.remove("moving"))},!1),thumbDiv.addEventListener("mouseover",function(e){if("IMG"===e.target.nodeName){var t=e.target.id;setTitle(t),currentThumb!==t?title.classList.add("moving"):title.classList.remove("moving")}},!1),thumbDiv.addEventListener("mouseout",function(){title.classList.remove("moving"),setTitle()},!1),document.querySelector("#check").onclick=function(){dragger.classList.toggle("hidden"),strips.classList.toggle("checks"),thumbDiv.classList.toggle("hidden"),thumbsMode=!thumbsMode,thumbs(),this.innerHTML="Thumbs"===this.innerHTML?"Dragger":"Thumbs",thumbsMode&&currentThumb<images.length&&setActiveClass(".thumb","active",document.getElementById(currentThumb))};var draggie=new Draggabilly(dragger,{grid:[grid_size,grid_size],containment:!0});draggie.on("dragStart",function(){dragStartPoint=currentThumb}),draggie.on("dragMove",onDragMove),draggie.on("dragEnd",onDragEnd);var france=document.querySelector("#france"),field=document.querySelector("#field"),sea=document.querySelector("#sea"),numbers=document.querySelector("#numbers");france.onclick=numbers.onclick=field.onclick=sea.onclick=function(){changeSet(this.getAttribute("id")),setActiveClass(".butto","active",this)},dragger.ondblclick=function(){alert("Don't click it dumbo, drag it")};