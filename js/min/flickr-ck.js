function wordInString(e,t){return new RegExp("\\b"+t+"\\b","gi").test(e)}function setImage(e){e=e||currentThumb,e<images.length?theImage.src=images[e][0]:(theImage.src="../img/noImage.jpg",timeoutID=window.setTimeout(function(){reJig(dragger.style.left)},300))}function reJig(e){var t=parseInt(e)-grid_size;dragger.style.left=t+"px",dragger.innerHTML=currentThumb,window.clearTimeout(timeoutID),currentThumb--,setImage(),setTitle(),title.classList.remove("noImage")}function setTitle(e){e=e||currentThumb,e<images.length?title.innerHTML=images[e][2]:title.innerHTML="No Image"}function reSetDragger(e){var t,r,s;oldNumOfPhotos>e&&parseInt(dragger.style.top)+1.5*grid_size>high&&(t=Math.ceil(e/squaresAccross-1)*grid_size+"px",dragger.style.top=t,r=parseInt(dragger.style.top)/grid_size,s=parseInt(dragger.style.left)/grid_size,_X=s,_Y=r*squaresAccross,dragger.innerHTML=r*squaresAccross+s+1,currentThumb=r*squaresAccross+s,setImage(),setTitle()),oldNumOfPhotos=e}function draggerShadowThumbs(e,t){dragger.style.left=e+"px",dragger.style.top=t+"px"}function setActiveClass(e,t,r){var s=document.querySelectorAll(e),i;for(i=s.length;i--;)s[i].classList.remove(t);r.classList.add(t)}function setDivHeight(e){var t=3,r=Math.ceil(e/t);checkers.style.height=r*grid_size+2*borderWidth+"px",checkers.style.width=t*grid_size+2*borderWidth+"px",wide=document.querySelector("#checkers").clientWidth,high=document.querySelector("#checkers").clientHeight,squaresAccross=wide/grid_size,reSetDragger(e)}function sortbydate(e,t){return e.datetaken>t.datetaken?1:e.datetaken<t.datetaken?-1:0}function makeArray(e){var t,r,s,i,o;for(jso.sort(sortbydate),images=[],t=jso.length;t--;)wordInString(jso[t].tags,e)&&(numOfThumbs++,r=jso[t].url_n,s=jso[t].url_sq,tag=jso[t].tags,tit=jso[t].title,i=jso[t].datetaken,o=jso[t].url_c,images.unshift([r,tag,tit,s,i,o]))}function thumbs(e,t){for(thumbDiv.innerHTML="",t=0;numOfThumbs>t;++t)e=document.createElement("img"),e.src=images[t][3],e.className="thumb",e.id=t,thumbDiv.appendChild(e)}function swapMode(){dragger.classList.toggle("hidden"),checkers.classList.toggle("checks"),thumbDiv.classList.toggle("hidden"),thumbs(),thumbsMode?toggleMode.innerHTML="Dragger":toggleMode.innerHTML="Thumbs",thumbsMode&&currentThumb<images.length&&setActiveClass(".thumb","active",document.getElementById(currentThumb))}function jsonFlickrApi(e){jso=e.photos.photo,makeArray(tag),setImage(),setTitle(),setDivHeight(images.length),thumbsMode&&swapMode()}function onDragMove(e){_X=e.position.x/grid_size,_Y=Math.floor(e.position.y/grid_size*squaresAccross),currentThumb=_Y+_X,dragger.innerHTML=currentThumb+1,setTitle(),currentThumb!==dragStartPoint&&title.classList.add("moving"),currentThumb>images.length-1?title.classList.add("noImage"):title.classList.remove("noImage")}function onDragEnd(){setImage(),setTitle(),title.classList.remove("moving")}function changeSet(e){numOfThumbs=0,makeArray(tag=e),setTitle(),setDivHeight(images.length),setImage(),thumbsMode&&(thumbs(),setActiveClass(".thumb","active",document.getElementById(currentThumb)))}function popLargeImage(){pops.src=images[currentThumb][5],popsDiv.classList.toggle("hidden"),popsTitle.innerHTML=images[currentThumb][2]}var dragger=document.querySelector("#draggable"),checkers=document.querySelector("#checkers"),thumbDiv=document.querySelector("#thumbs"),toggleMode=document.querySelector("#toggleMode"),numOfThumbs=0,borderWidth=10;checkers.style.borderWidth=borderWidth+"px";var theImage=document.querySelector("#theImage"),title=document.querySelector("#title"),tit,grid_size=dragger.offsetWidth,wide=document.querySelector("#checkers").clientWidth,high=document.querySelector("#checkers").clientHeight,squaresAccross=wide/grid_size,thumbsMode=!0,images=[],Draggabilly,jso={},tag="food",currentThumb=0,dragStartPoint=0,_X=0,_Y=0,oldNumOfPhotos,timeoutID,flickrURL="https://api.flickr.com/services/rest/?method=flickr.people.getPhotos&api_key=857e33af61016743c64d4aa90fa4782a&user_id=100786833%40N08&extras=tags%2Curl_n%2Curl_c%2Curl_sq%2Cdate_taken&format=json",script=document.createElement("script");script.type="text/javascript",script.src=flickrURL,document.head.appendChild(script),thumbDiv.addEventListener("click",function(e){"IMG"===e.target.nodeName&&(currentThumb=e.target.getAttribute("id"),setImage(),setTitle(),dragger.innerHTML=parseInt(currentThumb)+1,e.target.offsetLeft%grid_size===0?draggerShadowThumbs(e.target.offsetLeft,e.target.offsetTop):draggerShadowThumbs(e.target.offsetLeft-borderWidth,e.target.offsetTop-borderWidth),setActiveClass(".thumb","active",e.target),title.classList.remove("moving"))},!1),thumbDiv.addEventListener("mouseover",function(e){if("IMG"===e.target.nodeName){var t=e.target.id;setTitle(t),currentThumb!==t?title.classList.add("moving"):title.classList.remove("moving")}},!1),thumbDiv.addEventListener("mouseout",function(){title.classList.remove("moving"),setTitle()},!1),thumbDiv.addEventListener("dblclick",function(e){"IMG"===e.target.nodeName&&popLargeImage()},!1),toggleMode.onclick=function(){thumbsMode=!thumbsMode,swapMode()};var draggie=new Draggabilly(dragger,{grid:[grid_size,grid_size],containment:!0});draggie.on("dragStart",function(){dragStartPoint=currentThumb}),draggie.on("dragMove",onDragMove),draggie.on("dragEnd",onDragEnd);var france=document.querySelector("#francia"),field=document.querySelector("#food"),sea=document.querySelector("#briny"),numbers=document.querySelector("#numbers");france.onclick=numbers.onclick=field.onclick=sea.onclick=function(){changeSet(this.getAttribute("id")),setActiveClass(".butto","active",this)},dragger.ondblclick=function(){popLargeImage()};var pops=document.querySelector(".pops"),popsDiv=document.querySelector("#popsDiv"),popsTitle=document.querySelector(".popsTitle");theImage.onclick=popLargeImage,popsDiv.onclick=function(){pops.src="",popsDiv.classList.toggle("hidden")};