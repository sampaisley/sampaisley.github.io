function wordInString(e,t){return new RegExp("\\b"+t+"\\b","gi").test(e)}function setImage(e){e=e||_Y+_X-1,theImage.src=e<images.length?images[e][0]:"../img/noImage.jpg"}function setTitle(){title.innerHTML=_Y+_X-1<images.length?images[_Y+_X-1][2]:"No Image"}function reSetDragger(e){if(oldHeight>e&&parseInt(dragger.style.top)+1.5*grid_size>high){var t=Math.ceil(e/squaresAccross-1);dragger.style.top=t*grid_size+"px";var r=parseInt(dragger.style.top)/grid_size,i=parseInt(dragger.style.left)/grid_size-1;_X=i+2,_Y=r*squaresAccross,dragger.innerHTML=r*squaresAccross+i+2,setImage(),setTitle()}oldHeight=e}function draggerShadowThumbs(e,t){dragger.style.left=e+"px",dragger.style.top=t+"px"}function setDivHeight(e){var t=3,r=Math.ceil(e/3);strips.style.height=r*grid_size+2*borderWidth+"px",strips.style.width=t*grid_size+2*borderWidth+"px",wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,reSetDragger(e)}function makeArray(e){images=[];for(var t=jso.photos.photo.length;t--;)if(wordInString(jso.photos.photo[t].tags,e)){numOfThumbs++;var r=jso.photos.photo[t].url_n,i=jso.photos.photo[t].url_sq;tag=jso.photos.photo[t].tags,tit=jso.photos.photo[t].title,images.unshift([r,tag,tit,i])}}function thumbs(){thumbDiv.innerHTML="";for(var e,t=0;numOfThumbs>t;++t)e=document.createElement("img"),e.src=images[t][3],e.setAttribute("class",t),t%3===0&&0!==t&&(thumbDiv.innerHTML+="<br>"),thumbDiv.appendChild(e);thumbDiv.addEventListener("click",function(e){if("IMG"===e.target.nodeName){var t=e.target.getAttribute("class");setImage(t),dragger.innerHTML=parseInt(t)+1,draggerShadowThumbs(e.target.offsetLeft-borderWidth,e.target.offsetTop-borderWidth)}},!1)}function jsonFlickrApi(e){jso=e,makeArray(tag),setImage(),setTitle(),setDivHeight(images.length)}function onDragMove(e){_X=e.position.x/grid_size+1,_Y=Math.floor(e.position.y/grid_size*squaresAccross),dragger.innerHTML=_Y+_X,setTitle(),_X+_Y!==dragStartPoint&&title.classList.add("moving")}function onDragEnd(){setImage(),setTitle(),title.classList.remove("moving")}function setActiveClass(e,t){for(var r=document.querySelectorAll(".butto"),i=r.length;i--;)r[i].classList.remove(t);e.classList.add(t)}function changeSet(e){numOfThumbs=0,makeArray(tag=e),setImage(),setTitle(),setDivHeight(images.length),thumbsMode&&thumbs()}var dragger=document.querySelector("#draggable"),strips=document.querySelector("#strips"),thumbDiv=document.querySelector("#thumbs"),numOfThumbs=0,borderWidth=10;strips.style.borderWidth=borderWidth+"px";var theImage=document.querySelector("#theImage"),title=document.querySelector("#title"),tit,grid_size=dragger.clientWidth,wide=document.querySelector("#strips").clientWidth,high=document.querySelector("#strips").clientHeight,squaresAccross=wide/grid_size,thumbsMode=!1,images=[],Draggabilly,jso={},tag="france",dragStartPoint=0,_X=0,_Y=1,oldHeight;document.querySelector("#check").onclick=function(){dragger.classList.toggle("hidden"),thumbDiv.classList.toggle("hidden"),thumbsMode=!thumbsMode,thumbs()};var draggie=new Draggabilly(dragger,{grid:[grid_size,grid_size],containment:!0});draggie.on("dragStart",function(){dragStartPoint=_X+_Y}),draggie.on("dragMove",onDragMove),draggie.on("dragEnd",onDragEnd);var france=document.querySelector("#france"),field=document.querySelector("#field"),sea=document.querySelector("#sea"),numbers=document.querySelector("#numbers");france.onclick=numbers.onclick=field.onclick=sea.onclick=function(){changeSet(this.getAttribute("id")),setActiveClass(this,"active")},dragger.ondblclick=function(){thumbs()};